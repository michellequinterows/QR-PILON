<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Pilón AR</title>

<script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>

<style>
  body {
    margin: 0;
    background: #f5f5f5;
    overflow: hidden;
    font-family: Arial, sans-serif;
  }

  model-viewer {
    width: 100%;
    height: 100vh;
  }

  .boton-ar {
    position: fixed;
    bottom: 80px;
    left: 50%;
    transform: translateX(-50%);
    padding: 20px 45px;
    font-size: 20px;
    border: none;
    border-radius: 50px;
    background: black;
    color: white;
    cursor: pointer;
    box-shadow: 0 10px 30px rgba(0,0,0,0.3);
    z-index: 999;
  }

  .boton-ar:active {
    transform: translateX(-50%) scale(0.98);
  }
</style>
</head>

<body>

<!-- Preview del modelo -->
<model-viewer
  id="modeloAR"
  camera-controls
  auto-rotate
  shadow-intensity="1"
  ar
  ar-modes="webxr scene-viewer quick-look">
</model-viewer>

<button class="boton-ar" onclick="abrirAR()">
  Ver en tu espacio
</button>

<script>
function abrirAR() {
  const version = Math.floor(Math.random() * 100000); // Parámetro único para cache
  const isiOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
  const isAndroid = /Android/.test(navigator.userAgent);

  if (isiOS) {
    // iOS Quick Look: se agrega v= para forzar versión nueva
    window.location.href = "https://michellequinterows.github.io/QR-PILON/pilonmadera.usdz?v=" + version;
  } 
  else if (isAndroid) {
    // Android Scene Viewer: se agrega v= para evitar cache
    const glbUrl = encodeURIComponent("https://michellequinterows.github.io/QR-PILON/pilonmadera.glb?v=" + version);
    window.location.href =
      "intent://arvr.google.com/scene-viewer/1.0?file=" + glbUrl + "&mode=ar_only#Intent;scheme=https;package=com.google.ar.core;end;";
  } 
  else {
    alert("Abre este enlace desde un iPhone o Android compatible.");
  }
}

// Actualizar el <model-viewer> para que siempre cargue la última versión
document.addEventListener('DOMContentLoaded', () => {
  const version = Math.floor(Math.random() * 100000);
  const modelo = document.getElementById('modeloAR');
  modelo.src = "https://michellequinterows.github.io/QR-PILON/pilonmadera.glb?v=" + version;
});
</script>

</body>
</html>
